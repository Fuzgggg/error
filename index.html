<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Online Firebase</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f4f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0;}
  .container { background: #fff; padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 600px;}
  h2 { text-align: center; color: #333;}
  .hidden { display: none; }
  button { padding: 10px 20px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; background: #007bff; color: #fff; }
  button:hover { background: #0056b3; }
  .option { display: block; margin: 10px 0; }
  .progress { height: 20px; background: #ddd; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
  .progress-bar { height: 100%; width: 0; background: #28a745; transition: width 0.3s; }
  input { padding: 10px; width: 100%; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; }
</style>
</head>
<body>

<div class="container">
  <div id="loginDiv">
    <h2>Masuk Quiz</h2>
    <input type="text" id="teacherCode" placeholder="Masukkan kode guru">
    <button onclick="login()">Masuk</button>
  </div>

  <div id="categoryDiv" class="hidden">
    <h2>Pilih Kategori</h2>
    <button onclick="startQuiz('IPA')">IPA</button>
    <button onclick="startQuiz('IPS')">IPS</button>
    <button onclick="startQuiz('B. Indonesia')">Bahasa Indonesia</button>
  </div>

  <div id="quizDiv" class="hidden">
    <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
    <h2 id="questionText"></h2>
    <div id="optionsDiv"></div>
    <button onclick="nextQuestion()">Skip</button>
  </div>

  <div id="resultDiv" class="hidden">
    <h2>Hasil Quiz</h2>
    <p>Skor Anda: <span id="scoreText"></span> / 50</p>
    <button onclick="restartQuiz()">Ulangi Quiz</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Ganti dengan config Firebase milikmu
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID.firebaseio.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let questions = [];
  let currentQ = 0;
  let score = 0;

  // login
  function login(){
    const code = document.getElementById('teacherCode').value.trim();
    if(!code) { alert('Masukkan kode guru!'); return; }

    db.ref('teacherCodes/'+code).get().then(snapshot=>{
      if(snapshot.exists()){
        document.getElementById('loginDiv').classList.add('hidden');
        document.getElementById('categoryDiv').classList.remove('hidden');
      } else {
        alert('Kode guru salah!');
      }
    });
  }

  // start quiz
  function startQuiz(category){
    document.getElementById('categoryDiv').classList.add('hidden');
    document.getElementById('quizDiv').classList.remove('hidden');

    db.ref('questionBank/'+category).get().then(snapshot=>{
      if(snapshot.exists()){
        const bank = snapshot.val();
        questions = [];
        for(let i=0;i<50;i++){
          questions.push(bank[Math.floor(Math.random()*bank.length)]);
        }
        currentQ = 0;
        score = 0;
        showQuestion();
      } else {
        alert('Bank soal kategori ini belum tersedia di Firebase!');
      }
    });
  }

  function showQuestion(){
    if(currentQ >= questions.length){
      showResult();
      return;
    }
    const q = questions[currentQ];
    document.getElementById('questionText').innerText = `Soal ${currentQ+1}: ${q.q}`;
    const optionsDiv = document.getElementById('optionsDiv');
    optionsDiv.innerHTML = '';
    q.a.forEach((opt,index)=>{
      const btn = document.createElement('button');
      btn.innerText = opt;
      btn.className='option';
      btn.onclick = ()=>{answerQuestion(index)};
      optionsDiv.appendChild(btn);
    });
    document.getElementById('progressBar').style.width = ((currentQ/50)*100)+'%';
  }

  function answerQuestion(idx){
    if(idx === questions[currentQ].correct) score++;
    currentQ++;
    showQuestion();
  }

  function nextQuestion(){
    currentQ++;
    showQuestion();
  }

  function showResult(){
    document.getElementById('quizDiv').classList.add('hidden');
    document.getElementById('resultDiv').classList.remove('hidden');
    document.getElementById('scoreText').innerText = score;

    // simpan ke Firebase
    const playerName = prompt('Masukkan nama pemain:','Anonim');
    db.ref('quizResults').push({
      name: playerName,
      score: score,
      timestamp: Date.now()
    });
  }

  function restartQuiz(){
    document.getElementById('resultDiv').classList.add('hidden');
    document.getElementById('loginDiv').classList.remove('hidden');
  }
</script>
</body>
</html>l
